# Requirements: v0.1 Foundation

**Milestone**: 0.1 - Foundation
**Status**: Active
**Created**: 2025-12-30

---

## Milestone Goal

Establish the project foundation with proper workspace structure, documentation, and basic API design. This milestone creates the scaffolding for all subsequent development.

---

## Success Criteria

- [ ] Workspace compiles with all three crates
- [ ] Public API is defined (even if stubbed)
- [ ] Documentation is complete and consistent
- [ ] Examples demonstrate intended usage
- [ ] Integration tests validate basic structure
- [ ] No external tool dependencies (yet)

---

## Requirements by Priority

### P0 (Must Have)

#### REQ-001: Workspace Structure

Create a Cargo workspace with three members:

```toml
[workspace]
members = ["forge_core", "forge_runtime", "forge_agent"]
```

**Acceptance:**
- `cargo build --workspace` succeeds
- `cargo test --workspace` succeeds
- Each crate has its own `Cargo.toml`

#### REQ-002: Public API Definition

Define the core public API even if implementations are stubs.

**forge_core types:**
```rust
pub struct Forge { /* */ }

pub struct GraphModule { /* */ }
pub struct SearchModule { /* */ }
pub struct CfgModule { /* */ }
pub struct EditModule { /* */ }
```

**Acceptance:**
- `use forge::Forge;` compiles
- `forge.graph()` returns `GraphModule`
- All module types are public

#### REQ-003: Error Types

Define comprehensive error hierarchy.

```rust
pub enum ForgeError {
    DatabaseError(String),
    SymbolNotFound(String),
    InvalidQuery(String),
    EditConflict { file: String, span: Span },
    VerificationFailed { file: String, reason: String },
    // ...
}
```

**Acceptance:**
- `std::error::Error` implemented
- Error variants cover all planned operations
- Error messages are actionable

#### REQ-004: Documentation

Complete project documentation set.

**Documents:**
- README.md - Project overview
- ARCHITECTURE.md - System design
- API.md - API reference
- PHILOSOPHY.md - Design principles
- DEVELOPMENT_WORKFLOW.md - Process
- CONTRIBUTING.md - Guidelines
- ROADMAP.md - Project roadmap

**Acceptance:**
- All documents exist and are complete
- Cross-references are accurate
- Code examples compile

### P1 (Should Have)

#### REQ-005: Basic Storage Abstraction

Define storage interface even if only SQLite is implemented initially.

```rust
pub trait GraphStore {
    fn query_symbols(&self, query: &str) -> Result<Vec<Symbol>>;
    fn query_references(&self, id: SymbolId) -> Result<Vec<Reference>>;
    // ...
}
```

**Acceptance:**
- Trait defined with required methods
- SQLite implementation exists
- Mock implementation for testing

#### REQ-006: Test Infrastructure

Set up test utilities and fixtures.

**Components:**
- `tests/fixtures/` directory
- `tests/common/mod.rs` with utilities
- Test data repositories

**Acceptance:**
- Integration tests can be run
- Fixtures are representative

### P2 (Nice to Have)

#### REQ-007: CLI Examples

Example CLI applications demonstrating usage.

**Examples:**
- `examples/basic_query.rs` - Basic graph queries
- `examples/simple_rename.rs` - Rename operation

**Acceptance:**
- Examples compile and run
- Demonstrated in README

---

## Non-Requirements

Explicitly OUT of scope for this milestone:

- Actual Magellan integration (REQ in v0.2)
- Actual Splice integration (REQ in v0.2)
- File watching (REQ in v0.3)
- Agent loop (REQ in v0.4)
- Native V3 backend (REQ in v0.5)

---

## Technical Constraints

### File Size Limits

- Maximum 300 LOC per module
- Modules exceeding limit require documented justification
- Test files may exceed to 500 LOC

### Dependencies

- Minimize external dependencies
- Prefer existing tools (Magellan, Splice, etc.)
- Document any new dependency addition

### API Stability

- APIs are considered unstable until v1.0
- Breaking changes allowed before v1.0
- Document breaking changes in CHANGELOG

---

## Testing Strategy

### Unit Tests

Each module should have:
- Constructor/builder tests
- Error case tests
- Basic operation tests (even if stubbed)

### Integration Tests

- Workspace builds successfully
- Public API is accessible
- Examples compile and run

### Documentation Tests

- All code examples compile
- Cross-references are valid
- Commands in docs work as described

---

## Dependencies

### External

| Crate | Version | Purpose |
|--------|---------|---------|
| sqlitegraph | ^1.5 | Graph backend |
| tokio | latest | Async runtime |
| anyhow | latest | Error handling |
| serde | latest | Serialization |

### Internal

| Module | Purpose |
|---------|---------|
| forge_core | Core library |
| forge_runtime | Runtime layer |
| forge_agent | Agent layer |

---

## Milestone Dependencies

None - this is the foundation milestone.

---

## Risks and Mitigations

| Risk | Impact | Mitigation |
|-------|---------|------------|
| API design changes | Delays to v0.2 | Keep APIs abstract, iterate on internals |
| Documentation drift | Confusion for contributors | DOCUMENT everything in design phase |
| Workspace complexity | Build issues | Start simple, add complexity as needed |

---

## Deliverables Checklist

- [ ] All documentation files created
- [ ] Cargo workspace set up
- [ ] All three crates compile
- [ ] Public API stubs defined
- [ ] Error types defined
- [ ] Basic tests pass
- [ ] README examples work
- [ ] CHANGELOG.md created
- [ ] LICENSE file present

---

*Last updated: 2025-12-30*
